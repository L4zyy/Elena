<!DOCTYPE html>
<html>
	<title>EleNa</title>
	<link rel = "stylesheet" href = "http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css"/>
</head>

<body>
<div id="path" d="{{ path }}" style="display:none"></div>
<div id="isPath" d="{{ isPath }}" style="display:none"></div>
<div id ="topnavbar" class="topnav">
    <h2 id="elena">ELENA</h2>

    <form id="form" method="post">
        <input type="text" id="startlocation" name="slocation" placeholder="Start Location" >
        <input  type="text" id="endlocation" name="elocation" placeholder="End Location">
        <button onclick="reselect()" type="button">Reselect</button>
        <input class="form-control" type="number" step="0.01" id="percentageofshortestdistance" name="%distance" placeholder="% of SD">               
         <select class="form-control" id="minmax" name="minmax">
            <option value="Min">Min</option>
            <option value="Max">Max</option>
        </select>
        <input id="submitbutton" type="submit" value="Submit" class="btn btn-primary btn-sm">
    </form>

</div>

<div id = "map" style = "width: 1000px; height: 800px"></div>
<script src = "http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
<script>
var isPath = document.getElementById('isPath').getAttribute('d');

var startSelected = false;
var endSelected = false;
// Creating map options
var mapOptions = {
	center: [42.378076, -72.519946],
	zoom: 18
}
// Creating a map object
var map = new L.map('map', mapOptions);

// Creating a Layer object
var layer = new L.TileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png');

// Adding layer to the map
map.addLayer(layer);

var popup = L.popup();

function onMapClick(e) {
    popup
        .setLatLng(e.latlng)
        .setContent("You clicked the map at " + e.latlng.toString())
        .openOn(map);

    if (startSelected == false){
    	document.getElementById("startlocation").value = e.latlng.toString();
    	startSelected = true;
    }
    else{
    	document.getElementById("endlocation").value = e.latlng.toString();
    	endSelected = true;
    }
}

function reselect(){
	startSelected = false;
	endSelected = false;
	document.getElementById("startlocation").value = "";
	document.getElementById("endlocation").value = "";
}

map.on('click', onMapClick);

function connectTheDots(path){
    var c = [];
    for(i in path) {
        var x = path[i]['lat'];
        var y = path[i]['lng'];
        c.push([x, y]);
    }
    return c;
}

if (isPath == 'true'){
    var path = document.getElementById('path').getAttribute('d');
    var pathList = JSON.parse(path);
    coords = connectTheDots(pathList);
    var line = L.polyline(coords).addTo(map);
}

</script>
</body>



</html>