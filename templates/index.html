<!DOCTYPE html>
<html>
	<title>EleNa</title>
	<link rel = "stylesheet" href = "http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css"/>
</head>

<body>


<h2 id="elena" style="font-size: 25px;Comic Sans MS, Comic Sans, cursive">EleNa: Elevation-based Navigation</h2>
<div id = "map" style = "width: 100%; height: 1500px; margin-left:auto; margin-right:auto; margin-top: 45px"></div>
<div id="path" d="{{ path }}" style="display:none"></div>
<div id="isPath" d="{{ isPath }}" style="display:none"></div>
<div id="mapcenter1" d="{{ mapcenter1 }}" style="display:none"></div>
<div id="mapcenter2" d="{{ mapcenter2 }}" style="display:none"></div>
<div id="zoom1" d="{{ zoom }}" style="display:none"></div>
<div id="ratio1" d="{{ ratio }}" style="display:none"></div>
<div id="minmax1" d="{{ minmax }}" style="display:none"></div>

<div id="cacheStart" d="{{ cacheStart }}" style="display:none"></div>
<div id="cacheEnd" d="{{ cacheEnd }}" style="display:none"></div>


<div id ="topnavbar" class="topnav" style="position: fixed ; left: 55px; top: 100px">

    <form id="form" method="post" >
        Start: <input type="text" readonly="readonly" style="background:#CCCCCC" id="startlocation" name="slocation" placeholder="Start Location"  style = "width:300px; height:40px; ">
        End: <input  type="text" readonly="readonly" style="background:#CCCCCC" id="endlocation" name="elocation" placeholder="End Location" style = "width:300px; height:40px;">
        <button onclick="reselect()" type="button" style = "width:60px; height:30px;font-family: FontAwesome; font-size:16px;background-color:#AED6F1;">Clear</button>
        
</div>
<div id ="topnavbar2" class="topnav2" style="position: fixed ; left: 55px; top: 130px">        
    % of Shortest Distance: <br> <input class="form-control" value="100"  type="number" step="0.01" id="percentageofshortestdistance" name="%distance" style = "width:200px; height:20px;">   
        <select class="form-control" id="minmax" name="minmax" style = "width:200px; height: 27px;">
            <option value="Min">Minimize Elevation Gain</option>
            <option value="Max">Maximize Elevation Gain</option>
        </select>
        <input id="submitbutton" type="submit" value="Search" class="btn btn-primary btn-sm" style = "width:70px;height:30px; font-family: FontAwesome; font-size:16px;background-color:#AED6F1;" >

		<input type="text" readonly="readonly" style="display:none" id="mapcenter" name="mapcenter" placeholder="mapcenter">
        <input type="text" readonly="readonly" style="display:none" id="zoom" name="zoom" placeholder="zoom">
    </form>
</div>
<div id ="topnavbar3" class="topnav3" style="position: fixed ; left: 55px; top: 60px">
    Shortest Path Length: {{ spLength }}m, Shortest Path Elevation Gain: {{ spHeight }}m, Current Path Length: {{ curLength }}m, Elevation Gain: {{ curHeight }}m
</div>
<div id ="buttomBar" class="botnav" style="position: fixed ; right: 15px; bottom: 10px">
    <button type="button" onclick="backToOrigin()">Back To Amherst</button>
</div>

<script src = "http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
<script>
var isPath = document.getElementById('isPath').getAttribute('d');
var mapOptions
var startSelected = false;
var endSelected = false;
// Creating map options
if (isPath == 'true'){
    mapOptions = {
    center: [Number(document.getElementById('mapcenter1').getAttribute('d')), Number(document.getElementById('mapcenter2').getAttribute('d'))],
    zoom: Number(document.getElementById('zoom1').getAttribute('d'))
    } 
    document.getElementById("startlocation").value = document.getElementById('cacheStart').getAttribute('d');
    document.getElementById("endlocation").value = document.getElementById('cacheEnd').getAttribute('d');
    startSelected = true;
    endSelected = true;
}else{
    mapOptions = {
    center: [42.378076, -72.519946],
    zoom: 16
}
}

// Creating a map object
var map = new L.map('map', mapOptions);
var line = null;

// Creating a Layer object
var layer = new L.TileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png');

// Adding layer to the map
map.addLayer(layer);

map.addEventListener('mousemove', function(ev) {
    document.getElementById("mapcenter").value = map.getCenter().toString();
    document.getElementById("zoom").value = map.getZoom().toString();
});

map.addEventListener('wheel', function(ev) {
    document.getElementById("mapcenter").value = map.getCenter().toString();
    document.getElementById("zoom").value = map.getZoom().toString();
});
document.getElementById("mapcenter").value = map.getCenter().toString();
document.getElementById("zoom").value = map.getZoom().toString();
var popup = L.popup();
var count = 0; 
var but1 = null; 
var but2 = null; 

var greenIcon = new L.Icon({
  iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
  shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
  iconSize: [25, 41],
  iconAnchor: [12, 41],
  popupAnchor: [1, -34],
  shadowSize: [41, 41]
});

function onMapClick(e) { 
    document.getElementById("mapcenter").value = map.getCenter().toString();
    document.getElementById("zoom").value = map.getZoom().toString();

    popup
        .setLatLng(e.latlng)
        .setContent("You clicked the map at " + e.latlng.toString())
        .openOn(map);
		
	if (e.latlng['lat'] > 42.428183|| e.latlng['lat'] < 42.305842 || e.latlng['lng'] < -72.540402 ||e.latlng['lng'] > -72.466113) {
		window.alert("The location you selected is outside of Amherst area. Please reselect it. ");
	}
	
    else if (startSelected == false){ 
		but1 = L.marker(e.latlng).addTo(map);
		but1.addTo(map);
    	document.getElementById("startlocation").value = e.latlng.toString();
    	startSelected = true;
    }
    else{ 
		if (endSelected == true){
			map.removeLayer(but2)
		}
		but2 = L.marker(e.latlng, {icon: greenIcon}).addTo(map);
		but2.addTo(map);
    	document.getElementById("endlocation").value = e.latlng.toString();
    	endSelected = true;
    }
}

function reselect(){
	startSelected = false;
	endSelected = false;
	document.getElementById("startlocation").value = "";
	document.getElementById("endlocation").value = "";
    
    if (but1 != null){
        map.removeLayer(but1)
        but1 = null
    }
    if (but2 != null){
        map.removeLayer(but2)
        but2 = null
    }

    if (line != null){
        map.removeLayer(line);
        line = null
    }
}

map.on('click', onMapClick);

function connectTheDots(path){
    var c = [];
    for(i in path) {
        var x = path[i]['lat'];
        var y = path[i]['lng'];
        c.push([x, y]);
    }
    return c;
}

if (isPath == 'true'){
    var path = document.getElementById('path').getAttribute('d');
    var pathList = JSON.parse(path);
    coords = connectTheDots(pathList);
    line = L.polyline(coords).addTo(map);

    document.getElementById("topnavbar3").style.display=""

    document.getElementById("percentageofshortestdistance").value = document.getElementById('ratio1').getAttribute('d');

    document.getElementById("minmax").value = document.getElementById('minmax1').getAttribute('d');
    //$("#minmax").val(document.getElementById('minmax1').getAttribute('d'))

}
else{
    document.getElementById("topnavbar3").style.display="none"
}

function backToOrigin(){
	map.setView([42.378076, -72.519946], 16);
}

</script>
</body>
<style>
h2{text-align: center;}


</html>